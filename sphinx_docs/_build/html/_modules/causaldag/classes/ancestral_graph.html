

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>causaldag.classes.ancestral_graph &mdash; causaldag  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> causaldag
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../classes/index.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../structure_learning/index.html">Structure Learning</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">causaldag</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>causaldag.classes.ancestral_graph</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for causaldag.classes.ancestral_graph</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">causaldag.utils</span> <span class="kn">import</span> <span class="n">core_utils</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">itr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">FrozenSet</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">causaldag.classes.custom_types</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">DirectedEdge</span><span class="p">,</span> <span class="n">BidirectedEdge</span><span class="p">,</span> <span class="n">UndirectedEdge</span><span class="p">,</span> <span class="n">NodeSet</span>


<span class="k">class</span> <span class="nc">CycleError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># def __init__(self, source, target):</span>
        <span class="c1">#     self.source = source</span>
        <span class="c1">#     self.target = target</span>
        <span class="c1">#     message = &#39;%s -&gt; %s will cause a cycle&#39; % (source, target)</span>
        <span class="c1">#     super().__init__(message)</span>


<span class="k">class</span> <span class="nc">SpouseError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># def __init__(self, ancestor, desc):</span>
        <span class="c1">#     self.ancestor = ancestor</span>
        <span class="c1">#     self.desc = desc</span>
        <span class="c1">#     message = &#39;%s &lt;-&gt; %s cannot be added since %s is an ancestor of %s&#39; % (ancestor, desc, ancestor, desc)</span>
        <span class="c1">#     super().__init__(message)</span>


<span class="k">class</span> <span class="nc">AdjacentError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">arrow_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node1</span> <span class="o">=</span> <span class="n">node1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node2</span> <span class="o">=</span> <span class="n">node2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrow_type</span> <span class="o">=</span> <span class="n">arrow_type</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> cannot be added since </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%s</span><span class="s1"> are already adjacent&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">node1</span><span class="p">,</span> <span class="n">arrow_type</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NeighborError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">neighbors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spouses</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="n">neighbors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parents</span> <span class="o">=</span> <span class="n">parents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spouses</span> <span class="o">=</span> <span class="n">spouses</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;The node </span><span class="si">%s</span><span class="s1"> has neighbors </span><span class="si">%s</span><span class="s1">. Nodes cannot have neighbors and parents/spouses.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;The node </span><span class="si">%s</span><span class="s1"> has parents </span><span class="si">%s</span><span class="s1">. Nodes cannot have neighbors and parents/spouses.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">parents</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spouses</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;The node </span><span class="si">%s</span><span class="s1"> has spouses </span><span class="si">%s</span><span class="s1">. Nodes cannot have neighbors and parents/spouses.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">spouses</span><span class="p">)))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">path2str</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;-&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>


<div class="viewcode-block" id="AncestralGraph"><a class="viewcode-back" href="../../../classes/AncestralGraph.html#causaldag.classes.ancestral_graph.AncestralGraph">[docs]</a><span class="k">class</span> <span class="nc">AncestralGraph</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for ancestral graphs, used to represent causal models with latent variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span> <span class="n">directed</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span> <span class="n">bidirected</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span> <span class="n">undirected</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">directed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">bidirected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">undirected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_undirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">AncestralGraph</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">same_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_nodes</span>
        <span class="n">same_directed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_directed</span>
        <span class="n">same_bidirected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_bidirected</span>
        <span class="n">same_undirected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_undirected</span>
        <span class="k">return</span> <span class="n">same_nodes</span> <span class="ow">and</span> <span class="n">same_directed</span> <span class="ow">and</span> <span class="n">same_bidirected</span> <span class="ow">and</span> <span class="n">same_undirected</span>

<div class="viewcode-block" id="AncestralGraph.copy"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.copy.html#causaldag.classes.ancestral_graph.AncestralGraph.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a copy of the current ancestral graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">AncestralGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bidirected</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">undirected</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">induced_subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the induced subgraph over only `nodes`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes:</span>
<span class="sd">            Set of nodes for the induced subgraph.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        g:</span>
<span class="sd">            Induced subgraph over `nodes`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; g = cd.AncestralGraph(bidirected={(1, 2), (1, 4)}, directed={(1, 3), (2, 3)})</span>
<span class="sd">        &gt;&gt;&gt; g.induced_subgraph()</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_directed</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>
        <span class="n">new_bidirected</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>
        <span class="n">new_undirected</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">AncestralGraph</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">new_directed</span><span class="p">,</span> <span class="n">bidirected</span><span class="o">=</span><span class="n">new_bidirected</span><span class="p">,</span> <span class="n">undirected</span><span class="o">=</span><span class="n">new_undirected</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Directed edges: </span><span class="si">%s</span><span class="s1">, Bidirected edges: </span><span class="si">%s</span><span class="s1">, Undirected edges: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># === MUTATORS</span>
<div class="viewcode-block" id="AncestralGraph.add_node"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.add_node.html#causaldag.classes.ancestral_graph.AncestralGraph.add_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a node to the ancestral graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node:</span>
<span class="sd">            a hashable Python object</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        add_nodes_from</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; g = cd.AncestralGraph()</span>
<span class="sd">        &gt;&gt;&gt; g.add_node(1)</span>
<span class="sd">        &gt;&gt;&gt; g.add_node(2)</span>
<span class="sd">        &gt;&gt;&gt; len(g.nodes)</span>
<span class="sd">        2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="AncestralGraph.add_nodes_from"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.add_nodes_from.html#causaldag.classes.ancestral_graph.AncestralGraph.add_nodes_from">[docs]</a>    <span class="k">def</span> <span class="nf">add_nodes_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Node</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a node to the ancestral graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes:</span>
<span class="sd">            an iterable of hashable Python objects</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        add_node</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; g = cd.AncestralGraph()</span>
<span class="sd">        &gt;&gt;&gt; g.add_nodes_from({1, 2})</span>
<span class="sd">        &gt;&gt;&gt; len(g.nodes)</span>
<span class="sd">        2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_check_ancestral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topological_sort</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_mark_children_visited</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">any_visited</span><span class="p">,</span> <span class="n">curr_path_visited</span><span class="p">,</span> <span class="n">curr_path</span><span class="p">,</span> <span class="n">stack</span><span class="p">):</span>
        <span class="n">any_visited</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">curr_path_visited</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">curr_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">any_visited</span><span class="p">[</span><span class="n">child</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mark_children_visited</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">any_visited</span><span class="p">,</span> <span class="n">curr_path_visited</span><span class="p">,</span> <span class="n">curr_path</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">curr_path_visited</span><span class="p">[</span><span class="n">child</span><span class="p">]:</span>
                <span class="n">cycle</span> <span class="o">=</span> <span class="n">curr_path</span> <span class="o">+</span> <span class="p">[</span><span class="n">child</span><span class="p">]</span>
                <span class="k">raise</span> <span class="n">CycleError</span>
        <span class="k">for</span> <span class="n">spouse</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">curr_path_visited</span><span class="p">[</span><span class="n">spouse</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">SpouseError</span>
        <span class="n">curr_path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">curr_path_visited</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">topological_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a linear order that is consistent with the partial order implied by ancestral relations of this graph.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">any_visited</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">}</span>
        <span class="n">curr_path_visited</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">}</span>
        <span class="n">curr_path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">any_visited</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mark_children_visited</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">any_visited</span><span class="p">,</span> <span class="n">curr_path_visited</span><span class="p">,</span> <span class="n">curr_path</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">stack</span><span class="p">))</span>

<div class="viewcode-block" id="AncestralGraph.add_directed"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.add_directed.html#causaldag.classes.ancestral_graph.AncestralGraph.add_directed">[docs]</a>    <span class="k">def</span> <span class="nf">add_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a directed edge from node `i` to node `j`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            source of directed edge.</span>
<span class="sd">        j:</span>
<span class="sd">            target of directed edge.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_ancestral</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">CycleError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="AncestralGraph.add_bidirected"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.add_bidirected.html#causaldag.classes.ancestral_graph.AncestralGraph.add_bidirected">[docs]</a>    <span class="k">def</span> <span class="nf">add_bidirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a bidirected edge between nodes `i` and `j`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            first endpoint of bidirected edge.</span>
<span class="sd">        j:</span>
<span class="sd">            second endpoint of bidirected edge.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CycleError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="AncestralGraph.add_undirected"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.add_undirected.html#causaldag.classes.ancestral_graph.AncestralGraph.add_undirected">[docs]</a>    <span class="k">def</span> <span class="nf">add_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an undirected edge between nodes `i` and `j`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            first endpoint of undirected edge.</span>
<span class="sd">        j:</span>
<span class="sd">            second endpoint of undirected edge.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_undirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_add_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ignore_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># === CHECK REMAINS ANCESTRAL</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_error</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">NeighborError</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># === CHECK i AND j NOT ALREADY ADJACENT</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ignore_error</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_undirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AdjacentError</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;-&gt;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_bidirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ignore_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># === CHECK REMAINS ANCESTRAL</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_error</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">NeighborError</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">neighbors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_error</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">NeighborError</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">neighbors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># === CHECK i AND j NOT ALREADY ADJACENT</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ignore_error</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_undirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AdjacentError</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ignore_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_undirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># === CHECK REMAINS ANCESTRAL</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">NeighborError</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">NeighborError</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">spouses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">NeighborError</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">NeighborError</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">spouses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># === CHECK i AND j NOT ALREADY ADJACENT</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ignore_error</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AdjacentError</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<div class="viewcode-block" id="AncestralGraph.remove_node"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.remove_node.html#causaldag.classes.ancestral_graph.AncestralGraph.remove_node">[docs]</a>    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ignore_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove `node`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">parent</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">child</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">child</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">child</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">spouse</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">spouse</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">spouse</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">spouse</span><span class="p">,</span> <span class="n">node</span><span class="p">}))</span>
            <span class="k">for</span> <span class="n">nbr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">nbr</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">nbr</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">nbr</span><span class="p">,</span> <span class="n">node</span><span class="p">}))</span>

            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_error</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="AncestralGraph.remove_directed"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.remove_directed.html#causaldag.classes.ancestral_graph.AncestralGraph.remove_directed">[docs]</a>    <span class="k">def</span> <span class="nf">remove_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ignore_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the directed edge from `i` to `j`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            source of directed edge.</span>
<span class="sd">        j:</span>
<span class="sd">            target of directed edge.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_error</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="AncestralGraph.remove_bidirected"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.remove_bidirected.html#causaldag.classes.ancestral_graph.AncestralGraph.remove_bidirected">[docs]</a>    <span class="k">def</span> <span class="nf">remove_bidirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ignore_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the bidirected edge between `i` and `j`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            first endpoint of bidirected edge.</span>
<span class="sd">        j:</span>
<span class="sd">            second endpoint of bidirected edge.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">}))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_error</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="AncestralGraph.remove_undirected"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.remove_undirected.html#causaldag.classes.ancestral_graph.AncestralGraph.remove_undirected">[docs]</a>    <span class="k">def</span> <span class="nf">remove_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ignore_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the undirected edge between `i` and `j`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            first endpoint of undirected edge.</span>
<span class="sd">        j:</span>
<span class="sd">            second endpoint of undirected edge.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">}))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_error</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span></div>

<div class="viewcode-block" id="AncestralGraph.remove_edge"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.remove_edge.html#causaldag.classes.ancestral_graph.AncestralGraph.remove_edge">[docs]</a>    <span class="k">def</span> <span class="nf">remove_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ignore_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            first endpoint of edge.</span>
<span class="sd">        j:</span>
<span class="sd">            second endpoint of edge.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_undirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_undirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">ignore_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span></div>

<div class="viewcode-block" id="AncestralGraph.remove_edges"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.remove_edges.html#causaldag.classes.ancestral_graph.AncestralGraph.remove_edges">[docs]</a>    <span class="k">def</span> <span class="nf">remove_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        edges</span>
<span class="sd">            TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span></div>

    <span class="c1"># === PROPERTIES</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nnodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">directed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">DirectedEdge</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bidirected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">BidirectedEdge</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_bidirected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">UndirectedEdge</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_directed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bidirected</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_undirected</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">UndirectedEdge</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="p">}</span>

<div class="viewcode-block" id="AncestralGraph.children_of"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.children_of.html#causaldag.classes.ancestral_graph.AncestralGraph.children_of">[docs]</a>    <span class="k">def</span> <span class="nf">children_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">NodeSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="AncestralGraph.parents_of"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.parents_of.html#causaldag.classes.ancestral_graph.AncestralGraph.parents_of">[docs]</a>    <span class="k">def</span> <span class="nf">parents_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">NodeSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="AncestralGraph.spouses_of"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.spouses_of.html#causaldag.classes.ancestral_graph.AncestralGraph.spouses_of">[docs]</a>    <span class="k">def</span> <span class="nf">spouses_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">NodeSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="AncestralGraph.neighbors_of"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.neighbors_of.html#causaldag.classes.ancestral_graph.AncestralGraph.neighbors_of">[docs]</a>    <span class="k">def</span> <span class="nf">neighbors_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">NodeSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_add_ancestors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ancestors</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">exclude_arcs</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ancestors</span> <span class="ow">and</span> <span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_arcs</span><span class="p">:</span>
                <span class="n">ancestors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_ancestors</span><span class="p">(</span><span class="n">ancestors</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">exclude_arcs</span><span class="o">=</span><span class="n">exclude_arcs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descendants</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">exclude_arcs</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">child</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">descendants</span> <span class="ow">and</span> <span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_arcs</span><span class="p">:</span>
                <span class="n">descendants</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_descendants</span><span class="p">(</span><span class="n">descendants</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">exclude_arcs</span><span class="o">=</span><span class="n">exclude_arcs</span><span class="p">)</span>

<div class="viewcode-block" id="AncestralGraph.ancestors_of"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.ancestors_of.html#causaldag.classes.ancestral_graph.AncestralGraph.ancestors_of">[docs]</a>    <span class="k">def</span> <span class="nf">ancestors_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">exclude_arcs</span><span class="o">=</span><span class="nb">set</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the nodes upstream of node</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes:</span>
<span class="sd">            Set of nodes.</span>
<span class="sd">        exclude_arcs:</span>
<span class="sd">            TODO</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        descendants_of</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        Set[node]</span>
<span class="sd">            Return all nodes j such that there is a directed path from j to node.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ancestors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_ancestors</span><span class="p">(</span><span class="n">ancestors</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">exclude_arcs</span><span class="o">=</span><span class="n">exclude_arcs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ancestors_of</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ancestors</span></div>

    <span class="k">def</span> <span class="nf">ancestor_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary from each node to its ancestors.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        ancestors_of</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        Dict[node,Set]</span>
<span class="sd">            Mapping node to ancestors</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">top_sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topological_sort</span><span class="p">()</span>

        <span class="n">node2ancestors_plus_self</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">top_sort</span><span class="p">:</span>
            <span class="n">node2ancestors_plus_self</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                <span class="n">node2ancestors_plus_self</span><span class="p">[</span><span class="n">child</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">node2ancestors_plus_self</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">:</span>
            <span class="n">node2ancestors_plus_self</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="p">{</span><span class="n">node</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">core_utils</span><span class="o">.</span><span class="n">defdict2dict</span><span class="p">(</span><span class="n">node2ancestors_plus_self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">descendant_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary from each node to its descendants.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        ancestors_of</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        Dict[node,Set]</span>
<span class="sd">            Mapping node to ancestors</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">top_sort</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topological_sort</span><span class="p">()</span>

        <span class="n">node2descendants_plus_self</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">top_sort</span><span class="p">):</span>
            <span class="n">node2descendants_plus_self</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                <span class="n">node2descendants_plus_self</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">node2descendants_plus_self</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">:</span>
            <span class="n">node2descendants_plus_self</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="p">{</span><span class="n">node</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">core_utils</span><span class="o">.</span><span class="n">defdict2dict</span><span class="p">(</span><span class="n">node2descendants_plus_self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">)</span>

<div class="viewcode-block" id="AncestralGraph.descendants_of"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.descendants_of.html#causaldag.classes.ancestral_graph.AncestralGraph.descendants_of">[docs]</a>    <span class="k">def</span> <span class="nf">descendants_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">exclude_arcs</span><span class="o">=</span><span class="nb">set</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the nodes downstream of node</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node:</span>
<span class="sd">            The node.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        ancestors_of</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        Set[node]</span>
<span class="sd">            Return all nodes j such that there is a directed path from node j.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">descendants</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_descendants</span><span class="p">(</span><span class="n">descendants</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">exclude_arcs</span><span class="o">=</span><span class="n">exclude_arcs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">descendants</span></div>

    <span class="k">def</span> <span class="nf">has_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if this graph has the directed edge i-&gt;j.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        has_bidirected</span>
<span class="sd">        has_undirected</span>
<span class="sd">        has_any_edge</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            Node.</span>
<span class="sd">        j:</span>
<span class="sd">            Node.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span>

    <span class="k">def</span> <span class="nf">has_bidirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if this graph has a bidirected edge between `i` and `j`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        has_directed</span>
<span class="sd">        has_undirected</span>
<span class="sd">        has_any_edge</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            Node.</span>
<span class="sd">        j:</span>
<span class="sd">            Node.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span>

    <span class="k">def</span> <span class="nf">has_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if this graph has an undirected edge between `i` and `j`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        has_directed</span>
<span class="sd">        has_bidirected</span>
<span class="sd">        has_any_edge</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            Node.</span>
<span class="sd">        j:</span>
<span class="sd">            Node.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span>

    <span class="k">def</span> <span class="nf">has_any_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if i and j are adjacent in this graph.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        has_directed</span>
<span class="sd">        has_bidirected</span>
<span class="sd">        has_undirected</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i:</span>
<span class="sd">            Node.</span>
<span class="sd">        j:</span>
<span class="sd">            Node.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_undirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                                                                                                                      <span class="n">j</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vstructures</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vstructs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="n">itr</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_any_edge</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
                    <span class="n">p1_</span><span class="p">,</span> <span class="n">p2_</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">))</span>
                    <span class="n">vstructs</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">p1_</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">p2_</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">vstructs</span>

    <span class="k">def</span> <span class="nf">colliders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_bidirected_reachable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">tmp</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">],</span> <span class="n">visited</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">],</span> <span class="n">node_subset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="n">node_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="k">if</span> <span class="n">node_subset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">node_subset</span>
        <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spouse</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">spouse</span><span class="p">:</span> <span class="n">spouse</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">node_subset</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected_reachable</span><span class="p">(</span><span class="n">spouse</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">node_subset</span><span class="o">=</span><span class="n">node_subset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmp</span>

    <span class="k">def</span> <span class="nf">c_components</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">set</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the c-components of this graph.</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        List[Set[node]]</span>
<span class="sd">            Return the partition of nodes coming from the relation of reachability by bidirected edges.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_queue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">visited_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">while</span> <span class="n">node_queue</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited_nodes</span><span class="p">:</span>
                <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bidirected_reachable</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">set</span><span class="p">(),</span> <span class="n">visited_nodes</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">components</span>

    <span class="k">def</span> <span class="nf">district_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node_subset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the district of a node, i.e., the set of nodes reachable by bidirected edges. If `node_subset` is</span>
<span class="sd">        provided, do this on the induced subgraph on that subset of nodes.</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        Set[node]</span>
<span class="sd">            The district of node.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected_reachable</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">(),</span> <span class="n">node_subset</span><span class="o">=</span><span class="n">node_subset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">discriminating_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colliders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colliders</span><span class="p">()</span>
        <span class="n">discriminating_paths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking discriminating paths&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">parents</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="c1"># potential endpoints of discriminating paths</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parents</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">nonadjacent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">-</span> <span class="n">parents</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">j</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking node </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2"> and non-adjacent nodes </span><span class="si">{</span><span class="n">nonadjacent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nonadjacent</span><span class="p">:</span>  <span class="c1"># potential start points of discriminating paths</span>
                <span class="c1"># search all paths that satisfy discriminating path criteria</span>
                <span class="n">path_queue</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">colliders</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="p">]</span>
                <span class="k">while</span> <span class="n">path_queue</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">path_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">final_node</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># check if path is discriminating for the next node</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">final_node</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="n">full_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">full_path</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                            <span class="n">discriminating_paths</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">full_path</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span>
                        <span class="k">elif</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="n">full_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">full_path</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                            <span class="n">discriminating_paths</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">full_path</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">final_node</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="n">full_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">full_path</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                            <span class="n">discriminating_paths</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">full_path</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>

                    <span class="c1"># extend path</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">final_node</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">colliders</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="n">new_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="n">new_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                            <span class="n">path_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">discriminating_paths</span>

    <span class="k">def</span> <span class="nf">_reachable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_node</span><span class="p">,</span> <span class="n">end_node</span><span class="p">,</span> <span class="n">visited</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span> <span class="n">allowed_edges</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">},</span>
                   <span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">allowed_nbrs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">allowed_edges</span><span class="p">:</span>
            <span class="n">allowed_nbrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">start_node</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;u&#39;</span> <span class="ow">in</span> <span class="n">allowed_edges</span><span class="p">:</span>
            <span class="n">allowed_nbrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">start_node</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">allowed_edges</span><span class="p">:</span>
            <span class="n">allowed_nbrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">start_node</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;p&#39;</span> <span class="ow">in</span> <span class="n">allowed_edges</span><span class="p">:</span>
            <span class="n">allowed_nbrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">start_node</span><span class="p">])</span>

        <span class="n">allowed_nbrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">nbr</span> <span class="k">for</span> <span class="n">nbr</span> <span class="ow">in</span> <span class="n">allowed_nbrs</span> <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">nbr</span><span class="p">)}</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allowed neighbors of </span><span class="si">{</span><span class="n">start_node</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">allowed_nbrs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Visited: </span><span class="si">{</span><span class="n">visited</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nbr</span> <span class="ow">in</span> <span class="n">allowed_nbrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nbr</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nbr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nbr</span> <span class="o">==</span> <span class="n">end_node</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reached end node&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reachable</span><span class="p">(</span><span class="n">nbr</span><span class="p">,</span> <span class="n">end_node</span><span class="p">,</span> <span class="n">visited</span><span class="o">=</span><span class="n">visited</span><span class="p">,</span> <span class="n">allowed_edges</span><span class="o">=</span><span class="n">allowed_edges</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">predicate</span><span class="p">,</span>
                                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reachability results:&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="c1"># === ???</span>
    <span class="k">def</span> <span class="nf">pairwise_markov_statements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="n">FrozenSet</span><span class="p">[</span><span class="n">Node</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">statements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itr</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_any_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="n">statements</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ancestors_of</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors_of</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})))</span>
        <span class="k">return</span> <span class="n">statements</span>

    <span class="k">def</span> <span class="nf">is_imap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">certify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if this graph is an IMAP of the `other` graph, i.e., all m-separation statements in this graph</span>
<span class="sd">        are also m-separation statements in `other`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other:</span>
<span class="sd">            Another DAG.</span>
<span class="sd">        certify:</span>
<span class="sd">            TODO</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        is_minimal_imap</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; g = cd.AncestralGraph(arcs={(1, 2), (3, 2)})</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_maximal</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Your graph is not maximal&quot;</span><span class="p">)</span>

        <span class="n">certificate</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">S</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairwise_markov_statements</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">msep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">S</span><span class="p">)),</span>
            <span class="kc">None</span><span class="p">)</span>
        <span class="n">is_imap_</span> <span class="o">=</span> <span class="n">certificate</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">certify</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">is_imap_</span><span class="p">,</span> <span class="n">certificate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">is_imap_</span>

    <span class="c1"># def is_minimal_imap(self, other, certify=False):</span>
    <span class="c1">#     print(&quot;THIS HAS NOT BEEN TESTED&quot;)</span>
    <span class="c1">#     certificate = next((</span>
    <span class="c1">#         i, j for i, j in self._directed | self._bidirected</span>
    <span class="c1">#         if other.msep(i, j, self.ancestors_of(i) | self.ancestors_of(j) - {i, j})</span>
    <span class="c1">#     ), False)</span>
    <span class="c1">#     res = not certificate and self.is_imap(other)</span>
    <span class="c1">#     if not certify:</span>
    <span class="c1">#         return res</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         return res, certificate</span>

    <span class="k">def</span> <span class="nf">is_minimal_imap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">certify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">check_imap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">check_imap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_imap</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">num_bidirected</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_directed</span><span class="p">):</span>
            <span class="n">new_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_maximal</span><span class="p">()</span> <span class="ow">and</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_imap</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">certify</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">certify</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">is_minimal_imap2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">certify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_imap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">check_imap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_imap</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">num_directed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bidirected</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">msep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors_of</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors_of</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">}):</span>
                <span class="n">new_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                    <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_maximal</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_imap</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">Exception</span>
                    <span class="k">if</span> <span class="n">certify</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">certify</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">is_minimal_imap3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">certify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_imap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">check_imap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_imap</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">num_directed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bidirected</span><span class="p">):</span>
            <span class="n">new_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">current_markov_blanket</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markov_blanket</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">district_of</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">new_markov_blanket</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">markov_blanket</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">|</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">district_of</span><span class="p">(</span>
                <span class="n">j</span><span class="p">)</span>
            <span class="n">mb_difference</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_markov_blanket</span> <span class="o">-</span> <span class="n">new_markov_blanket</span> <span class="o">-</span> <span class="p">{</span><span class="n">j</span><span class="p">})</span> <span class="o">|</span> <span class="p">{</span><span class="n">i</span><span class="p">}</span>
            <span class="n">rest</span> <span class="o">=</span> <span class="n">new_markov_blanket</span> <span class="o">-</span> <span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;i=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, j=</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">, mb_diff=</span><span class="si">{</span><span class="n">mb_difference</span><span class="si">}</span><span class="s1">, rest=</span><span class="si">{</span><span class="n">rest</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">msep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mb_difference</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_maximal</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;here&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_imap</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">Exception</span>
                <span class="k">if</span> <span class="n">certify</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">certify</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">is_minimal_imap4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">certify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_imap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extra_validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">check_imap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_imap</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not an IMAP&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;isn&#39;t imap&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">extra_validate</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">:</span>
                <span class="n">new_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">induced_subgraph</span><span class="p">(</span><span class="n">new_mag</span><span class="o">.</span><span class="n">ancestors_of</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})</span> <span class="o">|</span> <span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})</span><span class="o">.</span><span class="n">markov_blanket</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="n">j</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">msep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_maximal</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_imap</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CI test not sufficient&quot;</span><span class="p">,</span> <span class="n">new_mag</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;extra validated&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">num_directed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bidirected</span><span class="p">):</span>
            <span class="n">change</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">new_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

            <span class="c1"># works:</span>
            <span class="n">set1</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_mag</span><span class="o">.</span><span class="n">markov_blanket</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">ancestors_of</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">|</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">parents_of</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">remove_edge</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">msep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">set1</span><span class="p">)</span>

            <span class="c1"># new:</span>
            <span class="n">set2</span> <span class="o">=</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">induced_subgraph</span><span class="p">(</span><span class="n">new_mag</span><span class="o">.</span><span class="n">ancestors_of</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})</span> <span class="o">|</span> <span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})</span><span class="o">.</span><span class="n">markov_blanket</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">}</span>
            <span class="n">remove_edge2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">msep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">set2</span><span class="p">)</span>
            <span class="c1"># print(i, j, set2)</span>
            <span class="n">set3</span> <span class="o">=</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">markov_blanket</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">ancestors_of</span><span class="p">({</span><span class="n">j</span><span class="p">})</span> <span class="o">-</span> <span class="p">{</span><span class="n">j</span><span class="p">}</span>

            <span class="c1"># if set2 != set3:</span>
            <span class="c1">#     print(new_mag, j, set2, set3)</span>

            <span class="k">if</span> <span class="n">remove_edge2</span><span class="p">:</span>
                <span class="n">change</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># if self.has_bidirected(i, j) and other.msep(i, j, self.parents_of(j)) and other.msep(i, j, self.parents_of(i)):</span>
            <span class="c1">#     new_mag = self.copy()</span>
            <span class="c1">#     new_mag.remove_bidirected(i, j)</span>
            <span class="c1">#     change = True</span>
            <span class="c1"># elif self.has_directed(i, j) and other.msep(i, j, self.parents_of(j) - {i}):</span>
            <span class="c1">#     new_mag = self.copy()</span>
            <span class="c1">#     new_mag.remove_directed(i, j)</span>
            <span class="c1">#     change = True</span>
            <span class="k">if</span> <span class="n">change</span> <span class="ow">and</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_maximal</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">new_mag</span><span class="o">.</span><span class="n">is_imap</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CI test isn&#39;t sufficient: new MAG is not an IMAP&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">certify</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">certify</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">markov_blanket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">],</span> <span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the Markov blanket of a node with respect to the whole graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node: The node whose Markov blanket to find.</span>
<span class="sd">        flat: if True, return the Markov blanket as a set, otherwise return a dictionary mapping nodes in the district</span>
<span class="sd">            of node to their parents.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The Markov blanket of node, including the node itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flat</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">district_of</span><span class="p">(</span><span class="n">node</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">district</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">district_of</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">district</span> <span class="o">|</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">district</span><span class="p">))</span> <span class="o">|</span> <span class="p">{</span><span class="n">node</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">resolved_quasisinks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">res_qsinks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">new_resolved</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">-</span> <span class="n">res_qsinks</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">res_qsinks</span><span class="p">)</span> <span class="ow">and</span>
                                 <span class="ow">not</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">res_qsinks</span><span class="p">)</span> <span class="ow">and</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">markov_blanket</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">markov_blanket</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">res_qsinks</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_resolved</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_resolved</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">res_qsinks</span>

    <span class="k">def</span> <span class="nf">is_maximal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_mag</span><span class="o">.</span><span class="n">to_maximal</span><span class="p">(</span><span class="n">new</span><span class="o">=</span><span class="n">new</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_mag</span> <span class="o">==</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">to_maximal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new</span><span class="p">:</span>
            <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">converged</span><span class="p">:</span>
                <span class="c1"># === NEED DICTIONARY OF ANCESTORS AND C-COMPONENTS TO CHECK INDUCING PATHS</span>
                <span class="n">ancestor_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestor_dict</span><span class="p">()</span>
                <span class="n">c_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_components</span><span class="p">()</span>
                <span class="n">node2component</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_components</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">component</span><span class="p">:</span>
                        <span class="n">node2component</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==========&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ancestor dict:&#39;</span><span class="p">,</span> <span class="n">ancestor_dict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;C components&#39;</span><span class="p">,</span> <span class="n">c_components</span><span class="p">)</span>

                <span class="c1"># === FIND INDUCING PATHS BETWEEN PAIRS OF NODE</span>
                <span class="n">induced_pairs</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">non_adjacent_pairs</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itr</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span>
                                      <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_any_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">non_adjacent_pairs</span><span class="p">:</span>
                    <span class="n">check_ancestry</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span>
                    <span class="n">nbrs1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span>
                    <span class="n">nbrs2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-------------</span><span class="se">\n</span><span class="s2">Checking </span><span class="si">{</span><span class="n">node1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">node2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># ONLY CHECK PATHS BETWEEN SPOUSES/CHILDREN THAT ARE IN THE SAME C-COMPONENT</span>
                    <span class="k">for</span> <span class="n">nbr1</span><span class="p">,</span> <span class="n">nbr2</span> <span class="ow">in</span> <span class="n">itr</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">nbrs1</span><span class="p">,</span> <span class="n">nbrs2</span><span class="p">):</span>
                        <span class="n">same_component</span> <span class="o">=</span> <span class="n">node2component</span><span class="p">[</span><span class="n">nbr1</span><span class="p">]</span> <span class="o">==</span> <span class="n">node2component</span><span class="p">[</span><span class="n">nbr2</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">same_component</span> <span class="ow">and</span> <span class="n">nbr1</span> <span class="ow">in</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">nbr2</span> <span class="ow">in</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">node1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking neighbors </span><span class="si">{</span><span class="n">nbr1</span><span class="si">}</span><span class="s2"> (for </span><span class="si">{</span><span class="n">node1</span><span class="si">}</span><span class="s2">) and </span><span class="si">{</span><span class="n">nbr2</span><span class="si">}</span><span class="s2"> (for </span><span class="si">{</span><span class="n">node2</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reachable</span><span class="p">(</span><span class="n">nbr1</span><span class="p">,</span> <span class="n">nbr2</span><span class="p">,</span> <span class="n">visited</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span> <span class="n">allowed_edges</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">},</span> <span class="n">predicate</span><span class="o">=</span><span class="n">check_ancestry</span><span class="p">,</span>
                                               <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reachable&quot;</span><span class="p">)</span>
                                <span class="n">induced_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">))</span>
                                <span class="k">continue</span>
                            <span class="k">elif</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No path&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;found induced pairs: </span><span class="si">{</span><span class="n">induced_pairs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">induced_pairs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_bidirected</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>

                <span class="n">converged</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">induced_pairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="c1"># print(&#39;converged:&#39;, converged)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itr</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_any_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                    <span class="n">never_msep</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span> <span class="k">for</span> <span class="n">S</span> <span class="ow">in</span> <span class="n">core_utils</span><span class="o">.</span><span class="n">powerset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">-</span> <span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">}))</span>
                    <span class="k">if</span> <span class="n">never_msep</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_pag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="c1"># === CONVERTERS</span>
<div class="viewcode-block" id="AncestralGraph.to_amat"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.to_amat.html#causaldag.classes.ancestral_graph.AncestralGraph.to_amat">[docs]</a>    <span class="k">def</span> <span class="nf">to_amat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">amat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nnodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnodes</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed</span><span class="p">:</span>
            <span class="n">amat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">amat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bidirected</span><span class="p">:</span>
            <span class="n">amat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">amat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">undirected</span><span class="p">:</span>
            <span class="n">amat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">amat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">return</span> <span class="n">amat</span></div>

<div class="viewcode-block" id="AncestralGraph.from_amat"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.from_amat.html#causaldag.classes.ancestral_graph.AncestralGraph.from_amat">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_amat</span><span class="p">(</span><span class="n">amat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        amat</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">amat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">directed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">bidirected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">undirected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itr</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">)),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">vij</span> <span class="o">=</span> <span class="n">amat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">vji</span> <span class="o">=</span> <span class="n">amat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">vij</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">vji</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># arrowhead at j</span>
                <span class="n">directed</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">vij</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">vji</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># arrowhead at i</span>
                <span class="n">directed</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">vij</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">vji</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># arrowheads at both</span>
                <span class="n">bidirected</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">vij</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">vji</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># no arrowhead</span>
                <span class="n">undirected</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">AncestralGraph</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">)),</span> <span class="n">directed</span><span class="p">,</span> <span class="n">bidirected</span><span class="p">,</span> <span class="n">undirected</span><span class="p">)</span></div>

    <span class="c1"># === COMPARISON</span>
<div class="viewcode-block" id="AncestralGraph.markov_equivalent"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.markov_equivalent.html#causaldag.classes.ancestral_graph.AncestralGraph.markov_equivalent">[docs]</a>    <span class="k">def</span> <span class="nf">markov_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if this graph is Markov equivalent to the graph `other`. Two graphs are Markov equivalent iff.</span>
<span class="sd">        they have the same skeleton, same v-structures, and if whenever there is the same discriminating path for some</span>
<span class="sd">        node in both graphs, the node is a collider on that path in one graph iff. it is a collider on that path in</span>
<span class="sd">        the other graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other:</span>
<span class="sd">            Another AncestralGraph.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">same_skeleton</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">skeleton</span>
        <span class="n">same_vstructures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vstructures</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vstructures</span><span class="p">()</span>

        <span class="n">self_discriminating_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discriminating_paths</span><span class="p">()</span>
        <span class="n">other_discriminating_paths</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">discriminating_paths</span><span class="p">()</span>
        <span class="n">shared_disc_paths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">self_discriminating_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">other_discriminating_paths</span><span class="p">)</span>
        <span class="n">same_discriminating</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">self_discriminating_paths</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">==</span> <span class="n">other_discriminating_paths</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">shared_disc_paths</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">same_skeleton</span> <span class="ow">and</span> <span class="n">same_vstructures</span> <span class="ow">and</span> <span class="n">same_discriminating</span></div>

    <span class="k">def</span> <span class="nf">fast_markov_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use Algorithm 1 of &quot;Faster algorithms for Markov equivalence&quot; (Hu and Evans, 2020) to check for Markov</span>
<span class="sd">        equivalence between two graphs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">skeleton</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vstructures</span><span class="p">()</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">vstructures</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discriminating_triples</span><span class="p">()</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">discriminating_triples</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_tail_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ancestor_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">ancestors</span> <span class="o">=</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">|</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">|</span> <span class="p">{</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">}</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">district_of</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ancestors</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents_of</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span> <span class="o">|</span> <span class="n">d</span> <span class="o">-</span> <span class="p">{</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">discriminating_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the discriminating triples of the graph, which are triples of nodes that determine the discriminating</span>
<span class="sd">        paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d_triples</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">ancestor_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestor_dict</span><span class="p">()</span>
        <span class="n">desc_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descendant_dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">:</span>
            <span class="n">tail_vw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tail_of</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">ancestor_dict</span><span class="p">)</span>

            <span class="c1"># LINES 10-12</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tail_vw</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_any_edge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_any_edge</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">z</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2"> in tail of (</span><span class="si">{</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="n">d_triples</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">z</span><span class="p">}))</span>

            <span class="c1"># LINES 13-17</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">|</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">|</span> <span class="p">{</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">}</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">desc_dict</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">|</span> <span class="n">desc_dict</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">|</span> <span class="p">{</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spouses_of</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">district_of</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span> <span class="o">|</span> <span class="n">d</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_any_edge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_any_edge</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">z</span><span class="p">)):</span>
                    <span class="n">dis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">district_of</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">a</span> <span class="o">|</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">|</span> <span class="p">{</span><span class="n">z</span><span class="p">})</span>
                    <span class="k">if</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">dis</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2"> in district of </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> restricted to spouses, district&quot;</span><span class="p">)</span>
                        <span class="n">d_triples</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">z</span><span class="p">}))</span>

        <span class="k">return</span> <span class="n">d_triples</span> <span class="o">|</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">vstruct</span><span class="p">)</span> <span class="k">for</span> <span class="n">vstruct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vstructures</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">get_all_mec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="n">mags</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="n">queue</span><span class="p">:</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">mags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
            <span class="n">curr_dir</span><span class="p">,</span> <span class="n">curr_bidir</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">mag</span><span class="o">.</span><span class="n">_directed</span><span class="p">),</span> <span class="nb">frozenset</span><span class="p">({</span><span class="nb">frozenset</span><span class="p">({</span><span class="o">*</span><span class="n">e</span><span class="p">})</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">mag</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">})</span>
            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">curr_dir</span><span class="p">,</span> <span class="n">curr_bidir</span><span class="p">))</span>
            <span class="n">lmcs_dir</span><span class="p">,</span> <span class="n">lmcs_bidir</span> <span class="o">=</span> <span class="n">mag</span><span class="o">.</span><span class="n">legitimate_mark_changes</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">lmcs_dir</span><span class="p">:</span>
                <span class="n">new_dir</span> <span class="o">=</span> <span class="n">curr_dir</span> <span class="o">-</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)}</span>
                <span class="n">new_bidir</span> <span class="o">=</span> <span class="n">curr_bidir</span> <span class="o">|</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">new_dir</span><span class="p">,</span> <span class="n">new_bidir</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                    <span class="n">new_mag</span> <span class="o">=</span> <span class="n">mag</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">new_mag</span><span class="o">.</span><span class="n">add_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_mag</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">lmcs_bidir</span><span class="p">:</span>
                <span class="n">new_dir</span> <span class="o">=</span> <span class="n">curr_dir</span> <span class="o">|</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)}</span>
                <span class="n">new_bidir</span> <span class="o">=</span> <span class="n">curr_bidir</span> <span class="o">-</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">({</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">})}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">new_dir</span><span class="p">,</span> <span class="n">new_bidir</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                    <span class="n">new_mag</span> <span class="o">=</span> <span class="n">mag</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">new_mag</span><span class="o">.</span><span class="n">remove_bidirected</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">new_mag</span><span class="o">.</span><span class="n">add_directed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_mag</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mags</span>

<div class="viewcode-block" id="AncestralGraph.shd_skeleton"><a class="viewcode-back" href="../../../classes/generated/causaldag.classes.ancestral_graph.AncestralGraph.shd_skeleton.html#causaldag.classes.ancestral_graph.AncestralGraph.shd_skeleton">[docs]</a>    <span class="k">def</span> <span class="nf">shd_skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the structure Hamming distance between the skeleton of this graph and the skeleton of another graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other:</span>
<span class="sd">            the graph to which the SHD of the skeleton will be computed.</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        int</span>
<span class="sd">            The structural Hamming distance between :math:`G_1` and :math:`G_2` is the minimum number of arc additions,</span>
<span class="sd">            deletions, and reversals required to transform :math:`G_1` into :math:`G_2` (and vice versa).</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">skeleton</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">as_hashed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="p">),</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">),</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span><span class="p">)</span>

    <span class="c1"># === Algorithms</span>
    <span class="k">def</span> <span class="nf">_add_upstream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upstream</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">upstream</span><span class="p">:</span>
                <span class="n">upstream</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_upstream</span><span class="p">(</span><span class="n">upstream</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_is_collider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;return True if u-v-w is a collider&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">w</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">w</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">w</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">w</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_no_other_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">ancestor_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if there is any path from i to j other than possibly the direct edge i-&gt;j.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other_ancestors_j</span> <span class="o">=</span> <span class="n">ancestor_dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">i</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">other_ancestors_j</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">legitimate_mark_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return directed edges that can be changed to bidirected edges, and bidirected edges that can be changed to</span>
<span class="sd">        directed edges.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbose:</span>
<span class="sd">            If True, print each possible mark change and which condition it fails, if any.</span>
<span class="sd">        strict:</span>
<span class="sd">            If True, check discriminating path condition. Otherwise, check only equality of parents and spouses.</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        (mark_changes_dir, mark_changes_bidir)</span>
<span class="sd">            Directed edges that can be changed to bidirected edges, and bidirected edges that can be changed to directed</span>
<span class="sd">            edges (which will be the new directed edge).</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; g = cd.AncestralGraph(directed={(0, 1)}, bidirected={(1, 2)})</span>
<span class="sd">        &gt;&gt;&gt; g.legitimate_mark_changes()</span>
<span class="sd">        ({(0, 1)}, {(2, 1)})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undirected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only defined for DMAGs&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">strict</span><span class="p">:</span>
            <span class="c1"># print(&quot;TODO: CHECK&quot;)</span>
            <span class="n">ancestor_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestor_dict</span><span class="p">()</span>
            <span class="n">mark_changes_dir</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="nb">set</span><span class="p">()</span> <span class="ow">and</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="nb">set</span><span class="p">()</span>
                   <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_other_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ancestor_dict</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">bidirected</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">]</span>
            <span class="n">bidirected_reversed</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">]</span>
            <span class="n">mark_changes_bidir</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">bidirected</span> <span class="o">+</span> <span class="n">bidirected_reversed</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="nb">set</span><span class="p">()</span> <span class="ow">and</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">j</span><span class="p">}</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="nb">set</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">mark_changes_dir</span><span class="p">,</span> <span class="n">mark_changes_bidir</span>

        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
            <span class="n">disc_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discriminating_paths</span><span class="p">()</span>
            <span class="n">ancestor_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestor_dict</span><span class="p">()</span>

            <span class="n">mark_changes_dir</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directed</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">-&gt;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> =&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&lt;-&gt;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> ?&#39;</span><span class="p">)</span>
                <span class="n">parents_condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">parents_condition</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed parents condition on </span><span class="si">{</span><span class="n">parents_condition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">spouses_condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">spouses_condition</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed spouses condition on </span><span class="si">{</span><span class="n">spouses_condition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">ancestral_condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_other_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ancestor_dict</span><span class="p">)</span>
                <span class="c1"># ancestral_condition2 = i not in self.ancestors_of(j, exclude_arcs={(i, j)})</span>
                <span class="c1"># print(ancestral_condition == ancestral_condition2)</span>
                <span class="c1"># if ancestral_condition != ancestral_condition2:</span>
                <span class="c1">#     print(self, i, j, (ancestor_dict[j] - {i}) &amp; self._children[i], ancestor_dict[j], self._children[i])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ancestral_condition</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed ancestral condition&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># SECOND CONDITION</span>
                <span class="n">disc_paths_for_i</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">disc_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">disc_paths_condition</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">disc_paths_for_i</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">),</span>
                                            <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">disc_paths_for_i</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">disc_paths_condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed discriminating path condition on </span><span class="si">{</span><span class="n">disc_paths_condition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Passed&#39;</span><span class="p">)</span>
                <span class="n">mark_changes_dir</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

            <span class="n">mark_changes_bidir</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">forward_edges</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bidirected</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">forward_edges</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">reversed</span><span class="p">,</span> <span class="n">forward_edges</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&lt;-&gt;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> =&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">-&gt;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> ?&#39;</span><span class="p">)</span>
                <span class="n">parents_condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">parents_condition</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed parents condition on </span><span class="si">{</span><span class="n">parents_condition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">spouses_condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">{</span><span class="n">j</span><span class="p">}</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">spouses_condition</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed spouses condition on </span><span class="si">{</span><span class="n">spouses_condition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">ancestral_condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_other_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ancestor_dict</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">ancestral_condition</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;failed ancestral condition&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># SECOND CONDITION</span>
                <span class="n">disc_paths_for_i</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">disc_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">disc_paths_condition</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">disc_paths_for_i</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">),</span>
                                            <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">disc_paths_for_i</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">disc_paths_condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed discriminating path condition on </span><span class="si">{</span><span class="n">disc_paths_condition</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Passed&#39;</span><span class="p">)</span>
                <span class="n">mark_changes_bidir</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">mark_changes_dir</span><span class="p">,</span> <span class="n">mark_changes_bidir</span>

    <span class="k">def</span> <span class="nf">msep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">],</span> <span class="n">B</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">],</span> <span class="n">C</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span><span class="o">=</span><span class="nb">set</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether A and B are m-separated given C, using the Bayes ball algorithm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        A:</span>
<span class="sd">            Set</span>
<span class="sd">        B:</span>
<span class="sd">            Set</span>
<span class="sd">        C:</span>
<span class="sd">            Set</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        msep_from_given</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># type coercion</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">core_utils</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">core_utils</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">core_utils</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

        <span class="c1"># shade ancestors of C</span>
        <span class="n">shaded_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_upstream</span><span class="p">(</span><span class="n">shaded_nodes</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># marks whether the node has been encountered along a path where it has a tail or an arrowhead</span>
        <span class="n">_t</span> <span class="o">=</span> <span class="s1">&#39;tail&#39;</span>  <span class="c1"># tail</span>
        <span class="n">_a</span> <span class="o">=</span> <span class="s1">&#39;arrowhead&#39;</span>  <span class="c1"># arrowhead</span>

        <span class="n">schedule</span> <span class="o">=</span> <span class="p">{(</span><span class="n">node</span><span class="p">,</span> <span class="n">_t</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">A</span><span class="p">}</span>
        <span class="k">while</span> <span class="n">schedule</span><span class="p">:</span>
            <span class="n">node</span><span class="p">,</span> <span class="n">_dir</span> <span class="o">=</span> <span class="n">schedule</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">B</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">_dir</span><span class="p">)</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="n">_dir</span><span class="p">))</span>
            <span class="c1"># print(node, _dir)</span>

            <span class="c1"># if coming through a tail, won&#39;t encounter v-structure</span>
            <span class="k">if</span> <span class="n">_dir</span> <span class="o">==</span> <span class="n">_t</span> <span class="ow">and</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
                <span class="n">schedule</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">parent</span><span class="p">,</span> <span class="n">_t</span><span class="p">)</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">node</span><span class="p">]})</span>
                <span class="n">schedule</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">child</span><span class="p">,</span> <span class="n">_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node</span><span class="p">]})</span>
                <span class="n">schedule</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">spouse</span><span class="p">,</span> <span class="n">_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">spouse</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node</span><span class="p">]})</span>
                <span class="n">schedule</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">nbr</span><span class="p">,</span> <span class="n">_t</span><span class="p">)</span> <span class="k">for</span> <span class="n">nbr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">node</span><span class="p">]})</span>

            <span class="k">if</span> <span class="n">_dir</span> <span class="o">==</span> <span class="n">_a</span><span class="p">:</span>
                <span class="c1"># if coming through an arrowhead and see shaded node, can go through v-structure</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">shaded_nodes</span><span class="p">:</span>
                    <span class="n">schedule</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">parent</span><span class="p">,</span> <span class="n">_t</span><span class="p">)</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">[</span><span class="n">node</span><span class="p">]})</span>
                    <span class="n">schedule</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">spouse</span><span class="p">,</span> <span class="n">_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">spouse</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spouses</span><span class="p">[</span><span class="n">node</span><span class="p">]})</span>

                <span class="c1"># if coming through an arrowhead and see unconditioned node, can go through children and neighbors</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
                    <span class="n">schedule</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">child</span><span class="p">,</span> <span class="n">_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">node</span><span class="p">]})</span>
                    <span class="n">schedule</span><span class="o">.</span><span class="n">update</span><span class="p">({(</span><span class="n">nbr</span><span class="p">,</span> <span class="n">_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">nbr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighbors</span><span class="p">[</span><span class="n">node</span><span class="p">]})</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">msep_from_given</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">],</span> <span class="n">C</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span><span class="o">=</span><span class="nb">set</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all nodes m-separated from A given C.</span>

<span class="sd">        Uses algorithm similar to that in Geiger, D., Verma, T., &amp; Pearl, J. (1990).</span>
<span class="sd">        Identifying independence in Bayesian networks. Networks, 20(5), 507-534.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        A:</span>
<span class="sd">            Set</span>
<span class="sd">        B:</span>
<span class="sd">            Set</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        msep</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">core_utils</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">core_utils</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

        <span class="n">determined</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">descendants</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
            <span class="n">determined</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">descendants</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_upstream</span><span class="p">(</span><span class="n">descendants</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="n">reachable</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">i_links</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">labeled_links</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">:</span>
            <span class="n">i_links</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
            <span class="n">reachable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i_p_1_links</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="c1"># Find all unlabled links v-&gt;w adjacent to at least one link u-&gt;v labeled i, such that (u-&gt;v,v-&gt;w) is a legal pair.</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">i_links</span><span class="p">:</span>
                <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">link</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">v</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">u</span> <span class="o">==</span> <span class="n">w</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labeled_links</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_collider</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>  <span class="c1"># Is collider?</span>
                            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">descendants</span><span class="p">:</span>
                                <span class="n">i_p_1_links</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
                                <span class="n">reachable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Not collider</span>
                            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">determined</span><span class="p">:</span>
                                <span class="n">i_p_1_links</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
                                <span class="n">reachable</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_p_1_links</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">labeled_links</span> <span class="o">=</span> <span class="n">labeled_links</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">i_links</span><span class="p">)</span>
            <span class="n">i_links</span> <span class="o">=</span> <span class="n">i_p_1_links</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">reachable</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">AncestralGraph</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">directed</span><span class="o">=</span><span class="p">{(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)})</span>
    <span class="n">disc_paths</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">discriminating_paths</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Chandler Squires

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>